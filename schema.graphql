type Protocol @entity {
    id: ID!

    init: Boolean!

    lastBlock: BigInt!
    epoch: Epoch!

    totalSwaps: BigInt!
    totalLoans: BigInt! #update
    totalUsers: BigInt!
    totalNuggs: BigInt!
    totalItems: BigInt!
    totalItemSwaps: BigInt!

    genesisBlock: BigInt!
    interval: BigInt!

    xnuggUser: User! @depreicated
    nuggftUser: User!
    nullUser: User!

    xnuggTotalSupply: BigInt! @depreicated
    xnuggTotalEth: BigInt! @depreicated

    nuggftTotalEth: BigInt!

    nuggftStakedUsdPerShare: BigInt!
    nuggftStakedUsd: BigInt!
    nuggftStakedEthPerShare: BigInt!
    nuggftStakedEth: BigInt!
    nuggftStakedShares: BigInt!

    priceUsdcWeth: BigInt!
    priceWethXnugg: BigInt! @depreicated

    tvlEth: BigInt! @depreicated
    tvlUsd: BigInt! @depreicated

    defaultActiveNugg: Nugg

    activeNuggs: [Nugg!]! @derivedFrom(field: "protocol")
    activeItems: [NuggItem!]! @derivedFrom(field: "protocol")
}

type Offer @entity {
    id: ID!

    swap: Swap!
    user: User!

    eth: BigInt!
    ethUsd: BigInt!

    claimed: Boolean!

    owner: Boolean!
}

enum EpochStatus {
    OVER
    ACTIVE
    PENDING
}

type Epoch @entity {
    id: ID!
    idnum: BigInt!

    startblock: BigInt!
    endblock: BigInt!
    status: EpochStatus!

    _activeSwaps: [String!]!
    _activeItemSwaps: [String!]!
}

type Item @entity {
    id: ID!
    count: BigInt!
}

type NuggItem @entity {
    id: ID!

    item: Item!
    nugg: Nugg!

    numSwaps: BigInt!

    count: BigInt!

    protocol: Protocol
    activeSwap: ItemSwap

    swaps: [ItemSwap!]! @derivedFrom(field: "sellingNuggItem")
}

type Nugg @entity {
    id: ID!
    idnum: BigInt!

    user: User!

    protocol: Protocol
    activeSwap: Swap
    activeLoan: Loan

    dotnuggRawCache: [BigInt!]

    numSwaps: BigInt!

    burned: Boolean! #update
    swaps: [Swap!]! @derivedFrom(field: "nugg")

    items: [NuggItem!]! @derivedFrom(field: "nugg")

    offers: [ItemOffer!]! @derivedFrom(field: "nugg")

    loans: [Loan!]! @derivedFrom(field: "nugg")
}

type Swap @entity {
    id: ID!

    nugg: Nugg!

    offers: [Offer!]! @derivedFrom(field: "swap")

    epoch: Epoch
    endingEpoch: BigInt
    startingEpoch: Epoch

    num: BigInt!

    eth: BigInt!
    ethUsd: BigInt!

    owner: User!
    leader: User!
}

type Loan @entity {
    id: ID!

    nugg: Nugg!

    user: User!

    epoch: Epoch!
    endingEpoch: BigInt!

    feeEth: BigInt!
    feeUsd: BigInt!

    protocol: Protocol

    liquidated: Boolean!
    liquidatedBy: User
    liquidatedForEth: BigInt!
    liquidatedForUsd: BigInt!

    eth: BigInt!
    ethUsd: BigInt!
}

type User @entity {
    id: ID!

    xnugg: BigInt! @depreicated

    shares: BigInt! #update
    ethin: BigInt!
    ethout: BigInt!

    nuggs: [Nugg!]! @derivedFrom(field: "user")

    offers: [Offer!]! @derivedFrom(field: "user")

    loans: [Loan!]! @derivedFrom(field: "user")

    swaps: [Swap!]! @derivedFrom(field: "owner")
}

type ItemSwap @entity {
    id: ID!

    sellingNuggItem: NuggItem!

    offers: [ItemOffer!]! @derivedFrom(field: "swap")

    epochId: String
    epoch: Epoch
    endingEpoch: BigInt
    startingEpoch: Epoch

    num: BigInt!

    eth: BigInt!
    ethUsd: BigInt!

    owner: Nugg!
    leader: Nugg
}

type ItemOffer @entity {
    id: ID!

    swap: ItemSwap!
    nugg: Nugg!

    eth: BigInt!
    ethUsd: BigInt!

    claimed: Boolean!

    owner: Boolean!
}
